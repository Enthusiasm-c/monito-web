
> vercel-marketplace-neon@0.1.0 dev
> next dev --turbopack

   ▲ Next.js 15.1.6 (Turbopack)
   - Local:        http://localhost:3000
   - Network:      http://192.168.0.215:3000
   - Environments: .env

 ✓ Starting...
 ✓ Ready in 534ms
 ○ Compiling / ...
 ✓ Compiled / in 2s
 GET / 200 in 2119ms
 ✓ Compiled /api/products in 130ms
 GET /api/token-usage 200 in 172ms
 GET /api/uploads/pending-count 200 in 614ms
 GET /api/uploads/status?limit=5 200 in 619ms
 GET /api/suppliers 200 in 632ms
 GET /api/stats 200 in 964ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 968ms
 ✓ Compiled /admin in 94ms
 GET /admin 200 in 113ms
 ✓ Compiled /api/uploads/pending in 63ms
 GET /api/uploads/pending?page=1&limit=10 200 in 619ms
 GET / 200 in 54ms
 GET /api/token-usage 200 in 29ms
 GET /api/uploads/status?limit=5 200 in 73ms
 GET /api/suppliers 200 in 74ms
 GET /api/stats 200 in 119ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 121ms
 GET /api/uploads/pending-count 200 in 439ms
 ○ Compiling /api/upload-smart ...
 ✓ Compiled /api/upload-smart in 535ms
🚀 Starting background processing for upload: cmbrf0yj10002ouv12uvrde71
🔄 Starting processing for upload: cmbrf0yj10002ouv12uvrde71
 POST /api/upload-smart 200 in 2322ms
 GET /api/token-usage 200 in 53ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 148ms
✅ Updated status to processing for: cmbrf0yj10002ouv12uvrde71
 GET /api/stats 200 in 192ms
 GET /api/uploads/status?limit=5 200 in 340ms
 GET /api/suppliers 200 in 343ms
 GET /api/uploads/pending-count 200 in 481ms
🚀 Enhanced processing starting for upload: cmbrf0yj10002ouv12uvrde71
🔍 Enhanced Excel extraction starting: widi wiguna.xlsx
📊 Excel file has 3 sheets: Sheet1, Sheet2, Sheet3
📄 Processing sheet: "Sheet1"
   📋 Sheet "Sheet1": 242 non-empty rows
   🔬 Sheet structure: {
  nameColumn: 1,
  priceColumn: 3,
  unitColumn: 2,
  categoryColumn: -1,
  dataStartRow: 4,
  headerRow: 3
}
📄 Processing sheet: "Sheet2"
   📋 Sheet "Sheet2": 0 non-empty rows
   ⚠️ Skipping sheet "Sheet2": too few rows
📄 Processing sheet: "Sheet3"
   📋 Sheet "Sheet3": 0 non-empty rows
   ⚠️ Skipping sheet "Sheet3": too few rows
✅ Enhanced extraction completed: widi wiguna.xlsx
   📊 Rows: 205/242 (84.7%)
   🛍️ Products: 205
   📄 Sheets: 1
   ⏱️ Time: 768ms
   💰 Cost: $0.0000
🏢 Processing supplier: "widi"
   📞 Phone: Not provided
   📧 Email: Not provided
   📍 Address: Not provided
🆕 Creating new supplier: "widi"
📝 Supplier detection: "widi" → using cmbrf10fw0003ouv1ea6wrpwx
📋 Upload cmbrf0yj10002ouv12uvrde71 requires approval. Extracted data saved for review.
📋 Processing Log: cmbrf0yj10002ouv12uvrde71 - pending_review - 0.847 completeness
✅ Enhanced processing completed: cmbrf0yj10002ouv12uvrde71
   📊 Completeness: 84.7%
   🛍️ Products: 0
   💰 Cost: $0.0000
🎉 Successfully completed processing for: cmbrf0yj10002ouv12uvrde71
 GET /admin 200 in 64ms
 GET /api/uploads/pending?page=1&limit=10 200 in 848ms
 ✓ Compiled in 27ms
 GET /admin 200 in 77ms
 GET /admin 200 in 17ms
 ✓ Compiled in 22ms
 GET /admin 200 in 64ms
 GET /admin 200 in 15ms
 GET /admin 200 in 32ms
 GET /admin 200 in 52ms
 GET /api/uploads/pending?page=1&limit=10 200 in 786ms
 GET /admin 200 in 52ms
 GET /api/uploads/pending?page=1&limit=10 200 in 783ms
 ✓ Compiled in 18ms
 ✓ Compiled in 21ms
 ✓ Compiled in 19ms
 ✓ Compiled in 22ms
 ✓ Compiled /admin in 19ms
 GET /admin 200 in 92ms
 GET /admin 200 in 14ms
 GET /admin 200 in 13ms
 GET /admin 200 in 12ms
 GET /admin 200 in 12ms
 GET /admin 200 in 12ms
 GET /admin 200 in 12ms
 GET /admin 200 in 12ms
 GET /admin 200 in 13ms
 GET /admin 200 in 14ms
 ✓ Compiled / in 20ms
 GET / 200 in 77ms
 GET /api/token-usage 200 in 59ms
 GET /api/uploads/pending-count 200 in 1014ms
 GET /api/suppliers 200 in 1017ms
 GET /api/stats 200 in 1090ms
 GET /api/uploads/status?limit=5 200 in 1090ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 1092ms
 GET / 200 in 47ms
 GET /api/token-usage 200 in 30ms
 GET /api/suppliers 200 in 80ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 458ms
 GET /api/uploads/pending-count 200 in 464ms
 GET /api/stats 200 in 469ms
 GET /api/uploads/status?limit=5 200 in 726ms
 GET /admin 200 in 48ms
 GET /api/uploads/pending?page=1&limit=10 200 in 939ms
 ✓ Compiled /api/uploads/reject in 100ms
❌ Upload cmbrf0yj10002ouv12uvrde71 rejected by admin. Reason: cancel
 POST /api/uploads/reject 200 in 818ms
 GET /api/uploads/pending?page=1&limit=10 200 in 579ms
 GET / 200 in 57ms
 GET /api/token-usage 200 in 30ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 126ms
 GET /api/suppliers 200 in 128ms
 GET /api/stats 200 in 174ms
 GET /api/uploads/status?limit=5 200 in 327ms
 GET /api/uploads/pending-count 200 in 494ms
🚀 Starting background processing for upload: cmbrhehy50006ouv1iry765nt
🔄 Starting processing for upload: cmbrhehy50006ouv1iry765nt
 POST /api/upload-smart 200 in 3941ms
 GET /api/token-usage 200 in 54ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 148ms
 GET /api/suppliers 200 in 149ms
✅ Updated status to processing for: cmbrhehy50006ouv1iry765nt
 GET /api/stats 200 in 195ms
 GET /api/uploads/status?limit=5 200 in 429ms
 GET /api/uploads/pending-count 200 in 499ms
🚀 Enhanced processing starting for upload: cmbrhehy50006ouv1iry765nt
🔍 Enhanced PDF extraction starting: VALENTA cheese supplier.pdf
🐍 Starting enhanced Python PDF processor...
📤 Python error: /Users/denisdomashenko/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
📤 Python error: [ERROR] ❌ Camelot lattice extraction failed: Ghostscript is not installed. You can install it using the instructions here: https://camelot-py.readthedocs.io/en/master/user/install-deps.html
📤 Python output: [INFO] 📥 Downloading PDF from: https://cdc1w79ssc4kg6xh.public.blob.vercel-storage.com/VALENTA%20cheese%20supplier-GcORWZQQNwJTEfA882gyEvM1wKk7ht.pdf
[INFO] ✅ PDF downloaded to: /var/folders/bg/vg27pvzj23bd_z9kxfqg5zv40000gn/T/tmpma08el3u.pdf
[INFO] 🔧 Trying Camelot Lattice extraction...
[INFO] 🔍 Camelot lattice extraction starting...
[INFO] 🔧 Trying Camelot Stream extraction...
[INFO] 🔍 Camelot stream extraction starting...
[INFO] 📊 Found 5 tables with Camelot stream
[INFO] 📄 Processing table 1/5
[INFO] ✅ Found name column 0 and price column 1 in camelot_stream_table_1
[INFO] ✅ Table 1: 13 products from 42 rows
[INFO] 📄 Processing table 2/5
[INFO] ✅ Found name column 0 and price column 2 in camelot_stream_table_2
[INFO] ✅ Table 2: 6 products from 21 rows
[INFO] 📄 Processing table 3/5
[INFO] ✅ Found name column 0 and price column 1 in camelot_stream_table_3
[INFO] ✅ Table 3: 4 products from 14 rows
[INFO] 📄 Processing table 4/5
[INFO] ✅ Found name column 0 and price column 2 in camelot_stream_table_4
[INFO] 🔄 Trying mixed content extraction for camelot_stream_table_4
[INFO] 📝 Analyzing 30 text cells for mixed content
[INFO] 🛍️ Mixed content extraction found 0 unique products
[INFO] ✅ Table 4: 0 products from 21 rows
[INFO] 📄 Processing table 5/5
[INFO] ✅ Found name column 0 and price column 2 in camelot_stream_table_5
[INFO] 🔄 Trying mixed content extraction for camelot_stream_table_5
[INFO] 📝 Analyzing 28 text cells for mixed content
[INFO] 🛍️ Mixed content extraction found 0 unique products
[INFO] ✅ Table 5: 0 products from 16 rows
[INFO] 🔧 Trying pdfplumber extraction...
[INFO] 🔍 pdfplumber extraction starting...
[INFO] 📄 Processing page 1/4
[INFO] 📄 Processing page 2/4
[INFO] 📄 Processing page 3/4
[INFO] 📄 Processing page 4/4
[INFO] ✅ pdfplumber: 0 products from 4 pages
[INFO] 📊 camelot_stream: 23 products, 114 rows, score: 57.4
[INFO] 📊 pdfplumber: 0 products, 0 rows, score: 0.0
[INFO] 🏆 Best method: camelot_stream with score 57.4
=== ENHANCED_JSON_START ===
{
  "supplier": {
    "name": "Indonesian Cheese"
  },
  "products": [
    {
      "name": "HALLOUMI CHEESE",
      "price": 179.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "FETA CHEESE",
      "price": 179.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "COTTAGE CHEESE",
      "price": 181.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "PANEER CHEESE",
      "price": 179.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "RICOTTA CHEESE",
      "price": 95.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "MOZARELLA CHEESE",
      "price": 126.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "CHEDDAR CHEESE",
      "price": 245.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "YOUNG GOUDA CHEESE",
      "price": 255.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "OLD GOUDA CHEESE",
      "price": 269.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "PARMESAN CHEESE",
      "price": 245.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "TOMME CHEESE",
      "price": 245.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "COTIJA CHEESE",
      "price": 245.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "BLUE CHEESE",
      "price": 498.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_1",
      "category": null,
      "description": null
    },
    {
      "name": "HALLOUMI CHEESE",
      "price": 255.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_2",
      "category": null,
      "description": null
    },
    {
      "name": "FETA CHEESE",
      "price": 255.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_2",
      "category": null,
      "description": null
    },
    {
      "name": "COTTAGE CHEESE",
      "price": 190.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_2",
      "category": null,
      "description": null
    },
    {
      "name": "PANEER CHEESE",
      "price": 255.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_2",
      "category": null,
      "description": null
    },
    {
      "name": "RICOTTA CHEESE",
      "price": 117.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_2",
      "category": null,
      "description": null
    },
    {
      "name": "PECORINO CHEESE",
      "price": 399.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_2",
      "category": null,
      "description": null
    },
    {
      "name": "PECORINO CHEESE",
      "price": 399.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_3",
      "category": null,
      "description": null
    },
    {
      "name": "TOMME CHEESE",
      "price": 399.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_3",
      "category": null,
      "description": null
    },
    {
      "name": "CHEDDAR CHEESE",
      "price": 399.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_3",
      "category": null,
      "description": null
    },
    {
      "name": "BLUE CHEESE",
      "price": 598.0,
      "unit": "pcs",
      "sourceMethod": "camelot_stream_table_3",
      "category": null,
      "description": null
    }
  ],
  "errors": [],
  "metrics": {
    "totalRowsDetected": 114,
    "totalRowsProcessed": 23,
    "tokensUsed": 0,
    "costUsd": 0.0
  },
  "extractionMethods": {
    "camelotLattice": null,
    "camelotStream": {
      "tables": 5,
      "rows": 114
    },
    "pdfPlumber": {
      "pages": 4,
      "rows": 0
    },
    "bestMethod": "camelot_stream"
  }
}
=== ENHANCED_JSON_END ===
🔚 Python process finished with code: 0
📊 Total stdout length: 6754 characters
📊 Total stderr length: 472 characters
✅ Enhanced PDF extraction completed: VALENTA cheese supplier.pdf
   📊 Rows: 23/114 (20.2%)
   🛍️ Products: 23
   🔧 Best method: camelot_stream
   ⏱️ Time: 2417ms
   💰 Cost: $0.0000
🏢 Processing supplier: "Indonesian Cheese"
   📞 Phone: Not provided
   📧 Email: Not provided
   📍 Address: Not provided
🆕 Creating new supplier: "Indonesian Cheese"
📝 Supplier detection: "Indonesian Cheese" → using cmbrhel3w0007ouv15ohfq8jf
📋 Upload cmbrhehy50006ouv1iry765nt requires approval. Extracted data saved for review.
📋 Processing Log: cmbrhehy50006ouv1iry765nt - pending_review - 0.202 completeness
✅ Enhanced processing completed: cmbrhehy50006ouv1iry765nt
   📊 Completeness: 20.2%
   🛍️ Products: 0
   💰 Cost: $0.0000
🎉 Successfully completed processing for: cmbrhehy50006ouv1iry765nt
 GET /admin 200 in 51ms
 GET /api/uploads/pending?page=1&limit=10 200 in 635ms
 GET /admin 200 in 48ms
 GET /api/uploads/pending?page=1&limit=10 200 in 665ms
 GET /admin 200 in 53ms
 GET /api/uploads/pending?page=1&limit=10 200 in 633ms
 GET /admin 200 in 48ms
 GET /api/uploads/pending?page=1&limit=10 200 in 653ms
 GET /admin 200 in 55ms
 GET /api/uploads/pending?page=1&limit=10 200 in 660ms
 GET /admin 200 in 52ms
 GET /api/uploads/pending?page=1&limit=10 200 in 630ms
 GET / 200 in 54ms
 GET /api/token-usage 200 in 32ms
 GET /api/products?category=All%20Categories&limit=50&page=1&sortBy=name&sortOrder=asc&search= 200 in 121ms
 GET /api/stats 200 in 125ms
 GET /api/suppliers 200 in 125ms
 GET /api/uploads/status?limit=5 200 in 312ms
 GET /api/uploads/pending-count 200 in 457ms
 GET /admin 200 in 42ms
 GET /api/uploads/pending?page=1&limit=10 200 in 635ms
[?25h
